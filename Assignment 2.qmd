---
title: "Hvilke sammenhenger har vi mellom inntekt, kjønn og BMI?"
format: revealjs
editor: visual
lang: no_nb
csl: hvl_apa7_stil_bokmal_v1.csl
bibliography: Data Science.bib
---

```{r}
library(modelr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(vtable)
library(flextable)
library(scales)
library(tinytex)
```

```{r}
Sys.setlocale("LC_ALL", "Norwegian")
```


```{r}
heights <- modelr::heights
```


## Problemstilling

- Hva sier data fra modelr::heights om sammenhengen mellom inntekt, kjønn og BMI?

- Hvordan kan mønstre i data underbygge diskusjonen hos @judge2004 om fysisk fremtoning og suksess i arbeidslivet?


## Tabell fra Antonio

```{r}
ggplot(
  data = heights %>%
    filter(!is.na(income), !is.na(education), !is.na(sex)) %>%
    group_by(sex, education) %>%
    summarise(mean_income = mean(income), .groups = "drop"),
  aes(x = education, y = mean_income, fill = sex)
) +
  geom_col(position = "dodge") +
  scale_y_continuous(labels = label_comma()) +
  labs(
    x = "Utdanning",
    y = "Gjennomsnittlig inntekt",
    fill = "Kjønn",
    title = "Gjennomsnittlig inntekt etter utdanning og kjønn"
  ) +
  theme(
    axis.text = element_text(size = 15),
    axis.title = element_text(size = 15),
    plot.title = element_text(size = 16, face = "bold")
  )

```



## Datagrunnlag

```{r}
heights_bmi <- heights %>%
  mutate(
    bmi = (weight / (height^2)) * 703,
    sex = fct_recode(sex, Kvinner = "female", Menn = "male")
  ) %>%
  filter(!is.na(income))
```

- `height` og `weight` er gitt i tommwr og pund; faktor 703 konverterer til BMI i kg/m². Høyden er bare brukt for å regne ut BMI.
- Vi fjerner observasjoner uten registrert inntekt for å fokusere på relasjonen mellom inntekt, kjønn og BMI.

## Deskriptiv statistikk

```{r}
basic_stats <- heights_bmi %>%
  group_by(sex) %>%
  summarise(
    N = n(),
    `Gj. inntekt` = mean(income, na.rm = TRUE),
    `Median inntekt` = median(income, na.rm = TRUE),
    `Gj. BMI` = mean(bmi, na.rm = TRUE),
    `Median BMI` = median(bmi, na.rm = TRUE)
  )

basic_stats %>%
  mutate(
    `Gj. inntekt` = dollar(`Gj. inntekt`, prefix = "", suffix = " USD"),
    `Median inntekt` = dollar(`Median inntekt`, prefix = "", suffix = " USD"),
    `Gj. BMI` = number(`Gj. BMI`, accuracy = 0.1),
    `Median BMI` = number(`Median BMI`, accuracy = 0.1)
  ) %>%
  knitr::kable(col.names = c("Kjønn", "N", "Gj. inntekt", "Median inntekt", "Gj. BMI", "Median BMI"))
```

- Menn tjener klart mer enn kvinner i dette datasettet, både i gjennomsnitt og i median.
N- år det gjelder BMI, er medianen den samme for begge kjønn, men gjennomsnittet er litt høyere for kvinner.
- Det betyr at de fleste ligger omtrent likt, men kvinner har litt flere med høyere BMI-verdier.

## Fordeling av BMI

```{r}
heights_bmi %>%
  ggplot(aes(x = bmi, fill = sex)) +
  geom_histogram(alpha = 0.8, position = "dodge", bins = 40, color = "white") +
  scale_fill_manual(values = c("#88C0D0", "#BF616A"),
                    name = "Kjønn",
                    labels = c("Menn", "Kvinner")) +
  scale_x_continuous(breaks = seq(10, 40, by = 5)) +
  labs(
    title = "Fordeling av BMI etter kjønn",
    x = "BMI (Body Mass Index)",
    y = "Antall observasjoner"
  ) +
  theme_minimal(base_size = 16) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    legend.position = "top"
  )

```

- Diagrammet viser fordelingen av BMI for menn og kvinner.
- Begge kjønn ligger hovedsakelig mellom BMI 25 og 30, som regnes som normal til lett overvekt.
-Menn har en liten topp litt høyere enn kvinnene, altså litt høyere BMI i snitt.
- Kvinner har derimot noen flere med veldig høy BMI.
- Generelt er forskjellen liten. fordelingen ser ganske lik ut for begge kjønn.



## BMI og inntekt

```{r}
#| label: fig-bmi-inntekt-ryddig
#| fig-width: 10
#| fig-height: 6
#| echo: false
library(dplyr)
library(ggplot2)
library(scales)

base <- heights_bmi |>
  rename(inntekt = income, kjonn = sex, BMI = bmi) |>
  mutate(kjonn = forcats::fct_relevel(kjonn, "Menn", "Kvinner"))

# Nedprøv ~30 % av punktene for å unngå prikksalat
set.seed(123)
df_plot <- base |> dplyr::slice_sample(prop = 0.30)

ggplot(df_plot, aes(BMI, inntekt, colour = kjonn)) +
  geom_point(alpha = 0.25, size = 0.8) +
  geom_smooth(data = base, method = "lm", se = FALSE, linewidth = 1.2) +
  coord_cartesian(ylim = c(0, 200000)) +
  scale_y_continuous(
    labels = label_dollar(prefix = "", suffix = " USD", big.mark = " "),
    breaks = pretty_breaks(5)
  ) +
  scale_color_manual(values = c("Menn" = "#88C0D0", "Kvinner" = "#BF616A"), name = "Kjønn") +
  labs(
    title = "BMI og inntekt",
    subtitle = "Nedprøvd til 30 % av observasjonene for lesbarhet. Trend basert på hele datasettet",
    x = "BMI",
    y = "Inntekt (USD)"
  ) +
  theme_minimal(base_size = 16) +
  theme(
    legend.position = "top",
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank()
  )

```

# Det er en svak negativ trend mellom BMI og inntekt for begge kjønn.
# Menn ligger generelt høyere i inntekt, spesielt ved lavere BMI.

## Kjønnsforskjeller i inntekt fordelt på BMI-kvartil

## bruh
```{r}
heights_bmi %>%
mutate(
bmi_kategori = case_when(
bmi < 18.5 ~ "Undervektig",
bmi >= 18.5 & bmi < 25 ~ "Normal",
bmi >= 25 & bmi < 30 ~ "Overvektig",
bmi >= 30 ~ "Fedme",
TRUE ~ NA_character_
),
bmi_kategori = factor(
bmi_kategori,
levels = c("Undervektig", "Normal", "Overvektig", "Fedme")
)
) %>%
group_by(sex, bmi_kategori) %>%
summarise(
median_inntekt = median(income, na.rm = TRUE),
.groups = "drop"
) %>%
ggplot(aes(x = bmi_kategori, y = median_inntekt, fill = sex)) +
geom_col(position = position_dodge(width = 0.7)) +
scale_fill_manual(values = c("#88C0D0", "#BF616A")) +
scale_y_continuous(labels = dollar_format(prefix = "", suffix = " USD")) +
labs(
title = "Median inntekt etter BMI-kategori og kjønn",
x = "BMI-kategori",
y = "Median inntekt"
) +
theme_minimal(base_size = 16)

```
- Menn dominerer inntektsmessig i alle BMI-kvartiler.
- Største forskjellen ser vi i den laveste BMI-gruppa, mens forskjellen blir mindre mot høyere BMI.




## Korrelasjon mellom inntekt og BMI

```{r}
cor_tabel <- heights_bmi %>%
  summarise(
    `Korrelasjon totalt` = cor(income, bmi, use = "complete.obs")
  ) %>%
  mutate(Kategori = "Totalt") %>%
  relocate(Kategori) %>%
  bind_rows(
    heights_bmi %>%
      group_by(sex) %>%
      summarise(`Korrelasjon totalt` = cor(income, bmi, use = "complete.obs")) %>%
      rename(Kategori = sex)
  )

cor_tabel %>%
  mutate(`Korrelasjon totalt` = number(`Korrelasjon totalt`, accuracy = 0.01)) %>%
  knitr::kable(col.names = c("Kategori", "Korrelasjon (inntekt vs BMI)"))
```

- Tabellen viser korrelasjonen mellom inntekt og BMI.
- Vi ser at sammenhengen er svak og negativ – totalt er den på −0,07.
- Det betyr at høyere BMI henger sammen med litt lavere inntekt, men forskjellen er veldig liten.
- For menn er sammenhengen nesten fraværende (−0,05), mens for kvinner er den litt sterkere (−0,10).
- Med andre ord: BMI ser ikke ut til å påvirke inntekten særlig mye, men blant kvinner er tendensen tydeligere.


## Avgrensingar og videre arbeid

- Data er observasjonelle og fanger ikke nødvendigvis opp årsakssammenhenger.
- Inntekt er rapportert i USD og kan være påvirket av geografi og sektor.

## Konklusjon

1. Kjønn er en sterkere indikator for inntekt enn BMI i dette utvalget.

2. Lavere BMI henger svakt sammen med høyere inntekt, spesielt blant menn.

3. Resultatene støtter litteraturen som peker på fordeler knyttet til fysisk framtoning i arbeidslivet (@judge2004), selv om høyde ikke er eksplisitt analysert her.
