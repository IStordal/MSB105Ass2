---
title: "Hvilke sammenhenger har vi mellom inntekt, kjønn og BMI?"
format: revealjs
editor: visual
lang: no_nb
csl: hvl_apa7_stil_bokmal_v1.csl
bibliography: Data Science.bib
---

```{r}
library(modelr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(vtable)
library(flextable)
library(scales)
library(tinytex)
```

```{r}
Sys.setlocale("LC_ALL", "Norwegian")
```

```{r}
heights <- modelr::heights
```

## Problemstilling

-   Hva sier data hentet fra datasettet "modelr::heights" om sammenhengen mellom inntekt, kjønn og BMI?

-   Hvordan kan mønstre i data underbygge diskusjonen hos @judge2004 om fysisk fremtoning og suksess i arbeidslivet?

## Tabell fra Antonio

```{r}
ggplot(
  data = heights %>%
    filter(!is.na(income), !is.na(education), !is.na(sex)) %>%
    group_by(sex, education) %>%
    summarise(mean_income = mean(income), .groups = "drop"),
  aes(x = education, y = mean_income, fill = sex)
) +
  geom_col(position = "dodge") +
  scale_y_continuous(labels = label_comma()) +
  labs(
    x = "Utdanning",
    y = "Gjennomsnittlig inntekt",
    fill = "Kjønn",
    title = "Gjennomsnittlig inntekt etter utdanning og kjønn"
  ) +
  theme(
    axis.text = element_text(size = 15),
    axis.title = element_text(size = 15),
    plot.title = element_text(size = 16, face = "bold")
  )

```

## Datagrunnlag

```{r}
heights_bmi <- heights %>%
  mutate(
    bmi = (weight / (height^2)) * 703,
    sex = fct_recode(sex, Kvinner = "female", Menn = "male")
  ) %>%
  filter(!is.na(income))
```

-   I modellen er høyde og vekt oppgitt i henholvdsvis tommar og pund. For å finne frem til objektenes MBI benytes følgende formel: (vekt/ høyde\^2) \*703.
-   Vi fjernar observasjonar utan registrert inntekt for å fokusere på relasjonen mellom inntekt, kjønn og BMI.

## Deskriptiv statistikk

```{r}
heights_bmi %>%
  mutate(bmi_group = cut(bmi, breaks = c(0, 18.5, 25, 30, 100),
                         labels = c("Undervekt", "Normal", "Overvekt", "Fedme"))) %>%
  filter(!is.na(income), !is.na(bmi_group), !is.na(sex)) %>%
  group_by(sex, bmi_group) %>%
  summarise(mean_income = mean(income), .groups = "drop") %>%
  ggplot(aes(x = bmi_group, y = mean_income, fill = sex)) +
  geom_col(position = "dodge") +
  scale_y_continuous(labels = label_comma()) +
  labs(
    x = "BMI-kategori",
    y = "Gjennomsnittlig inntekt",
    fill = "Kjønn",
    title = "Gjennomsnittlig inntekt etter kjønn og BMI-kategori"
  ) +
  theme(
    axis.text = element_text(size = 15),
    axis.title = element_text(size = 15),
    plot.title = element_text(size = 16, face = "bold")
  )

```

```{r}
bmi_tabell <- data.frame(
  Kategori = c("Undervekt", "Normal vekt", "Overvekt", "Fedme"),
  Fra = c(0, 18.5, 25, 30),
  Til = c(18.5, 25, 30, Inf),
  Beskrivelse = c(
    "Lavere enn normalt, kan tyde på underernæring",
    "Sunn og normal vekt",
    "Litt over anbefalt vekt",
    "Høy vekt, økt helserisiko"
  )
)

# Vis tabellen
bmi_tabell

```

Verdens helse organisasjon (who) har grupert BMI skalaen i 4 hovedgrupper.
@canadian2003

```{r}
basic_stats <- heights_bmi %>%
  group_by(sex) %>%
  summarise(
    N = n(),
    `Gj. inntekt` = mean(income, na.rm = TRUE),
    `Median inntekt` = median(income, na.rm = TRUE),
    `Gj. BMI` = mean(bmi, na.rm = TRUE),
    `Median BMI` = median(bmi, na.rm = TRUE)
  )

basic_stats %>%
  mutate(
    `Gj. inntekt` = dollar(`Gj. inntekt`, prefix = "", suffix = " USD"),
    `Median inntekt` = dollar(`Median inntekt`, prefix = "", suffix = " USD"),
    `Gj. BMI` = number(`Gj. BMI`, accuracy = 0.1),
    `Median BMI` = number(`Median BMI`, accuracy = 0.1)
  ) %>%
  knitr::kable(col.names
                 = c("Kjønn", "N", "Gj. inntekt", "Median inntekt", "Gj. BMI", "Median BMI"))
```

-   Menn tjener i gjennomsnitt mer enn kvinner i dette datasettet.
-   Kjønnsforskjellen i BMI er mindre markant, men menn har noe høyere median.

## Fordeling av BMI

```{r}
heights_bmi %>%
  ggplot(aes(x = bmi, fill = sex)) +
  geom_histogram(alpha = 0.7, position = "identity", bins = 30) +
  scale_fill_manual(values = c("#88C0D0", "#BF616A")) +
  labs(
    title = "Fordeling av BMI etter kjønn",
    x = "BMI",
    y = "Antal"
  ) +
  theme_minimal(base_size = 16)
```

-   Begge kjønn viser en relativt normalfordelt BMI rundt midten av 20-tallet.
-   Kvinner har en litt mer sammenklemt fordeling, mens menn har flere observasjoner med høyere BMI.

## BMI og inntekt

```{r}
#| label: fig-bmi-inntekt-ryddig
#| fig-width: 10
#| fig-height: 6
#| echo: false
library(dplyr)
library(ggplot2)
library(scales)

base <- heights_bmi |>
  rename(inntekt = income, kjonn = sex, BMI = bmi) |>
  mutate(kjonn = forcats::fct_relevel(kjonn, "Menn", "Kvinner"))

# Nedprøv ~30 % av punktene for å unngå prikksalat
set.seed(123)
df_plot <- base |> dplyr::slice_sample(prop = 0.30)

ggplot(df_plot, aes(BMI, inntekt, colour = kjonn)) +
  geom_point(alpha = 0.25, size = 0.8) +
  geom_smooth(data = base, method = "lm", se = FALSE, linewidth = 1.2) +
  coord_cartesian(ylim = c(0, 200000)) +
  scale_y_continuous(
    labels = label_dollar(prefix = "", suffix = " USD", big.mark = " "),
    breaks = pretty_breaks(5)
  ) +
  scale_color_manual(values = c("Menn" = "#88C0D0", "Kvinner" = "#BF616A"), name = "Kjønn") +
  labs(
    title = "BMI og inntekt",
    subtitle = "Nedprøvd til 30 % av observasjonene for lesbarhet. Trend basert på hele datasettet",
    x = "BMI",
    y = "Inntekt (USD)"
  ) +
  theme_minimal(base_size = 16) +
  theme(
    legend.position = "top",
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank()
  )

```

# Det er en svak negativ trend mellom BMI og inntekt for begge kjønn.

# Menn ligger generelt høyere i inntekt, spesielt ved lavere BMI.

## Kjønnsforskjeller i inntekt fordelt på BMI-kvartil

```{r}
heights_bmi %>%
  mutate(bmi_kvartil = ntile(bmi, 4)) %>%
  group_by(sex, bmi_kvartil) %>%
  summarise(
    median_inntekt = median(income, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  ggplot(aes(x = factor(bmi_kvartil), y = median_inntekt, fill = sex)) +
  geom_col(position = position_dodge(width = 0.7)) +
  scale_fill_manual(values = c("#88C0D0", "#BF616A")) +
  scale_y_continuous(labels = dollar_format(prefix = "", suffix = " USD")) +
  labs(
    title = "Median inntekt etter BMI-kvartil og kjønn",
    x = "BMI-kvartil (1 = låg BMI)",
    y = "Median inntekt"
  ) +
  theme_minimal(base_size = 16)
```

-   Menn dominerer inntektsmessig i alle BMI-kvartiler.
-   Største forskjellen ser vi i den laveste BMI-gruppa, mens forskjellen blir mindre mot høyere BMI.

## Korrelasjon mellom inntekt og BMI

```{r}
cor_tabel <- heights_bmi %>%
  summarise(
    `Korrelasjon totalt` = cor(income, bmi, use = "complete.obs")
  ) %>%
  mutate(Kategori = "Totalt") %>%
  relocate(Kategori) %>%
  bind_rows(
    heights_bmi %>%
      group_by(sex) %>%
      summarise(`Korrelasjon totalt` = cor(income, bmi, use = "complete.obs")) %>%
      rename(Kategori = sex)
  )

cor_tabel %>%
  mutate(`Korrelasjon totalt` = number(`Korrelasjon totalt`, accuracy = 0.01)) %>%
  knitr::kable(col.names = c("Kategori", "Korrelasjon (inntekt vs BMI)"))
```

-   Korrelasjonen mellom inntekt og BMI er svak negativ totalt, og forskjellen mellom kjønn er små.
-   Dette tyder på at kjønnsforskjellene i inntekt hovedsaklig kommer frå andre forhold enn BMI.

## Avgrensingar og videre arbeid

-   Data er observasjonelle og fanger ikke nødvendigvis opp årsakssammenhenger.
-   Inntekt er rapportert i USD og kan være påvirket av geografi og sektor.

## Konklusjon

1.  Kjønn er en sterkere indikator for inntekt enn BMI i dette utvalget.

2.  Lavere BMI henger svakt sammen med høyere inntekt, spesielt blant menn.

3.  Resultatene støtter litteraturen som peker på fordeler knyttet til fysisk framtoning i arbeidslivet (@judge2004), selv om høyde ikke er eksplisitt analysert her.
